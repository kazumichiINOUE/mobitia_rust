### UI Screens (`src/ui/`)
このモジュールは、アプリケーションの各モード (`AppMode`) に対応するビューの描画ロジックを格納しています。各スクリーンは `MyApp` から必要な状態のスライスを受け取り、`egui` のウィジェットを使用して可視化します。座標変換は `egui::emath::RectTransform` を用いて、ワールド座標系からスクリーン座標系へと変換されます。

#### `lidar_screen.rs`
- **役割**: `AppMode::Lidar` で使用され、LiDARからの生のスキャンデータをリアルタイムに表示します。
- **描画内容**:
    - 各LiDARセンサーの原点とID。
    - センサーから取得した点群 (`LidarState::points`)。`config.toml` で設定されたLiDARごとの`origin`と`rotation`を考慮してワールド座標系に変換した上で描画されます。
    - 複数のLiDARの点群は、IDに応じて異なる色（緑、黄、青など）で描画されます。

#### `slam_screen.rs`
- **役割**: `AppMode::Slam` で使用され、SLAMの実行結果をリアルタイムに可視化します。ビューは常にロボットの現在位置が中心になるように追従します。
- **描画内容**:
    - **地図**: `MyApp::current_map_points` を描画します。各点は占有確率に応じて青色の濃淡で表現されます。
    - **最新スキャン**: SLAMに使用された最新のスキャンデータ (`MyApp::latest_scan_for_draw`) が、ロボットの現在姿勢に合わせて変換され、黄色で描画されます。
    - **ロボット**:
        - SLAMによる推定姿勢 (`MyApp::current_robot_pose`) が緑色の円と方向を示す線で描画されます。
        - モーターオドメトリによる姿勢 (`MyApp::motor_odometry`) がテキスト情報として左上に表示されます。
    - **軌跡**: ロボットの移動軌跡 (`MyApp::robot_trajectory`) が白い線と、向きを示すマーカーで描画されます。

```rust
// slam_screen.rs の draw 関数の抜粋
pub fn draw(
    &mut self,
    ui: &mut egui::Ui,
    // ...
    current_robot_pose: &Isometry2<f32>,
    robot_trajectory: &[(egui::Pos2, f32)],
    current_map_points: &[(Point2<f32>, f64)],
    latest_scan_for_draw: &[...],
    motor_odometry: &(f32, f32, f32),
) {
    // ... (左上にSLAM PoseとMotor Odomをテキスト表示) ...

    // ロボット中心にビューを設定
    let to_screen = // ... RectTransformの計算 ...

    // 地図、軌跡、最新スキャン、ロボット姿勢を描画
    // ...
}
```

#### `map_screen.rs`
- **役割**: `AppMode::Map` で使用され、オフラインで読み込んだサブマップ全体を表示します。
- **描画内容**:
    - `slam_screen` と同様に地図、軌跡、ロボット姿勢を描画します。
    - `slam_screen` と異なり、ビューは地図全体が表示されるように固定され、自動では追従しません。
    - 地図読み込み完了後、地図のバウンディングボックスの寸法（横幅・縦幅）をメートル単位で描画します。

#### `lidar_analysis_screen.rs`
- **役割**: `AppMode::LidarAnalysis` で使用され、LiDARデータから計算された特徴量をデバッグ目的で可視化します。
- **描画内容**:
    - 点群は、その**エッジらしさ (`edge_ness`)** に応じて赤（エッジ）〜緑（平面）のグラデーションで色付けされます。
    - エッジらしい点からは、その点の**法線ベクトル**が黄色の線で描画されます。
    - **コーナーらしさ (`corner_ness`)** が高いと判断された点は、マゼンタ色の大きな円で強調表示されます。

#### `nav_screen.rs`
- **役割**: `AppMode::Nav` で使用され、自律移動中の状態を総合的に可視化します。
- **描画内容**:
    - **メインビュー**: 地図全体、または読み込まれた領域全体を俯瞰します。
    - **拡大サブウィンドウ (Zoom PIP)**: 画面右下に、ロボット周辺（デフォルト4m四方）を拡大表示するピクチャ・イン・ピクチャ (Picture-In-Picture) を表示します。
        - これにより、狭い場所での壁とのクリアランスや、リカバリー動作時の詳細な挙動を、マウス操作なしで常時確認できます。
        - 表示範囲は `config.toml` の `[ui] nav_zoom_view_size` で変更可能です。
    - **経路**:
        - **Global Path**: `trajectory.txt` から読み込んだ初期経路（薄い青）。
        - **Local Path**: Elastic Band によって障害物を避けるように変形された現在の計画経路（緑/シアン）。
    - **ロボット**: 現在位置、向き、および物理的なフットプリント（矩形）を描画します。