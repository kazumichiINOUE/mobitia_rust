# Mobitia Configuration File

# --- General Application Settings ---
# [general]
# ui_theme = "Dark" # Possible values: "Dark", "Light"

[ui]
show_xppen_panel = false
show_camera_panel = false
show_osmo_panel = false

[slam]
# --- Map Representation ---
# The size of each grid cell in meters.
csize = 0.025

# The width of the occupancy grid in cells.
map_width = 12000
#map_width = 3200

# The height of the occupancy grid in cells.
map_height = 12000
#map_height = 3200

# The method used to update the occupancy grid.
# Possible values are: "Binary", "Probabilistic", "Hybrid"
map_update_method = "Probabilistic"

# How a point is represented within a cell.
# Possible values are: "CellCenter", "Centroid"
point_representation = "Centroid"

# Maximum log-odds value for a cell, preventing extreme confidence.
log_odds_clamp_max = 5.0

# Minimum log-odds value for a cell.
log_odds_clamp_min = -5.0

# --- Probabilistic Model (for "Probabilistic" or "Hybrid" map update methods) ---
# Probability assigned to a cell when a laser hits it.
prob_occupied = 0.6

# Probability assigned to a cell when a laser passes through it.
prob_free = 0.4

# Decay rate for log-odds values over time. A value of 1.0 means no decay.
decay_rate = 1.0

# --- Scan Matching (Pose Estimation) ---
# The maximum distance between a scan point and a map point to be considered a valid match.
max_matching_dist = 0.5

# The standard deviation (sigma) of the Gaussian function used for calculating the distance penalty in scan matching.
match_sigma = 0.1

# Sigma for the Gaussian kernel used in gaussian_match_count.
gaussian_kernel_sigma = 0.8

# Radius for the Gaussian kernel.
gaussian_kernel_radius = 1

# --- Scoring Weights (for Scan Matching) ---
# Weight for the position alignment component of the score.
position_score_weight = 0.1

# Weight for the feature (e.g., edge-ness) similarity component.
feature_score_weight = 0.4

# Weight for the alignment of normal vectors.
normal_alignment_score_weight = 0.5
corner_score_weight = 0.3

# --- Pose Update Penalties (for Scan Matching) ---
# Penalty applied for translational movement of the robot.
translation_penalty_weight = 100.0

# Penalty applied for rotational movement of the robot.
rotation_penalty_weight = 1000.0

# Log-odds threshold below which a penalty is applied.
penalty_log_odds_threshold = -0.2

# Factor to scale the penalty.
penalty_factor = 1.0

# --- Differential Evolution (Optimizer for Scan Matching) ---
# Number of individuals in the DE population.
population_size = 200

# Number of generations the DE algorithm runs for.
generations = 100

# Search window size for translation (x, y) in meters.
wxy = 0.8

# Search window size for rotation (angle) in degrees.
wa_degrees = 35.0

# Mutation factor for Differential Evolution.
f_de = 0.1

# Crossover rate for Differential Evolution.
cr = 0.6
# If true, use odometry difference as an initial guess for Differential Evolution in SLAM.
use_odometry_as_initial_guess = true

# --- Submap Generation ---
# Number of laser scans to be collected before generating a new submap.
num_scans_per_submap = 20

# The size of the viewing area (in meters) when running online SLAM.
online_slam_view_size = 50.0
min_valid_points_for_de = 0
update_interval_ms = 1000

[map]
# Delay in milliseconds between loading each submap for 'list-and-load'.
submap_load_delay_ms = 500
map_load_update_distance = 1.0

# --- LiDAR Configurations ---
# Each table in this array represents one LiDAR sensor.
# `rotation_deg` is in degrees, `origin` is in meters.

[[lidar]]
id = 0 # 進行方向右手のlidar
path = "/dev/cu.usbmodem14301"
baud_rate = 115200
origin_x = 0.0
origin_y = -0.26
rotation_deg = -93.0
data_filter_angle_min_deg = -90.0
data_filter_angle_max_deg = 135.0
is_active_for_slam = true

[[lidar]]
id = 1 # 進行方向左手のlidar
path = "/dev/cu.usbmodem14401"
baud_rate = 115200
origin_x = 0.0
origin_y = 0.26
# 90 degrees minus 1 degree
rotation_deg = 89.0
data_filter_angle_min_deg = -135.0
data_filter_angle_max_deg = 90.0
is_active_for_slam = true

[[lidar]]
id = 2 # 予備のlidar
path = "/dev/cu.usbmodem2101"
baud_rate = 115200
origin_x = 0.0
origin_y = 0.0
rotation_deg = 0.0
data_filter_angle_min_deg = -135.0
data_filter_angle_max_deg = 135.0
is_active_for_slam = false


[motor]
port = "/dev/cu.usbserial-AQ034S3S"
baud_rate = 230400
# Physical robot parameters
# Motor shaft rotation per step, in degrees.
step_resolution_deg = 0.01
wheel_diameter = 0.311 # meters
tread_width = 0.461    # meters
gear_ratio = 50.0
# Control limits
max_linear_velocity = 1.5 # m/s
max_angular_velocity = 1.0 # rad/s

[nav]
# Initial pose for navigation mode [x, y, angle_degrees]
initial_pose = [0.0, 0.0, 0.0]
debug_use_dummy_scan = false
